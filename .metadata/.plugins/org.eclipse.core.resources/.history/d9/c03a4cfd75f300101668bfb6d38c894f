package com.api_gateway.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.reactive.EnableWebFluxSecurity;
import org.springframework.security.config.web.server.ServerHttpSecurity;
import org.springframework.security.web.server.SecurityWebFilterChain;

@Configuration
@EnableWebFluxSecurity
public class SecurityConfig {

	    @Bean
	    SecurityWebFilterChain filterChain(ServerHttpSecurity http) {

	        return http
	            .csrf(csrf -> csrf.disable())
	            .authorizeExchange(ex -> ex

	                // PUBLIC
	                .pathMatchers("/auth/register", "/auth/login","product/getall").permitAll()

	                // ADMIN
	                .pathMatchers(
	                    "/inventory/restock",
	                    "/order/getall",
	                    "/user/getall",
	                    "/cart/getall",
	                    "/wishlist/getall"
	                ).hasRole("ADMIN")

	                // USER
	                .pathMatchers(
	                    "/order/create",
	                    "/order/check",
	                    "/user/getone",
	                    "/user/deletecartitem",
	                    "/cart/add",
	                    "/cart/remove",
	                    "/wishlist/add",
	                    "/wishlist/remove"
	                ).hasRole("USER")

	                // fallback
	                .anyExchange().authenticated()
	            )
	            .build();
	    }
	}


